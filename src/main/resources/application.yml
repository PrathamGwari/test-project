# ------------------------
# Default/Common Config
# ------------------------
spring:
  application:
    name: tariff-server
  profiles.active: ${SPRING_PROFILES_ACTIVE:prod}

  jpa:
    show-sql: true
    properties:
      hibernate:
        format_sql: true

server:
  port: 8080
  error:
    include-message: always
    include-binding-errors: always

# JWT Configuration (default)
app:
  jwt:
    # Read from environment variable; provide a benign dev fallback only
    secret: ${JWT_SECRET:dev-secret}
    expiration: 86400000  # 24 hours in milliseconds

# ------------------------
# Dev Profile (H2 In-memory for local development)
# ------------------------
---
spring:
  config:
    activate:
      on-profile: dev
    # Only dev should import local .env for convenience
    import: optional:file:.env[.properties]
  h2:
    console:
      enabled: true
  datasource:
    url: jdbc:h2:mem:tariffdb;DB_CLOSE_DELAY=-1;MODE=PostgreSQL
    driver-class-name: org.h2.Driver
    username: sa
    password:
  jpa:
    hibernate:
      ddl-auto: create-drop  # Clean slate each restart for dev
  flyway:
    enabled: false  # Disable for H2 development

# JWT Configuration for Dev (optional override)
app:
  jwt:
    # Allow overriding via env in local dev; keep short fallback
    secret: ${JWT_SECRET:dev-secret}
    expiration: 86400000

# ------------------------
# Prod Profile (Supabase PostgreSQL via Session Pooler)
# ------------------------
---
spring:
  config:
    activate:
      on-profile: prod
  datasource:
    # Use Azure App Settings; no secrets in source
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10   # start small 
      minimum-idle: 2
      idle-timeout: 30000     # 30s
      max-lifetime: 600000    # 10 min
      connection-timeout: 20000 # 20s
  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
  flyway:
    enabled: false  # Disable Flyway for now
  mvc:
    problemdetails:
      enabled: true
  messages:
    basename: messages

# JWT Configuration for Prod
app:
  jwt:
    secret: ${JWT_SECRET}
    expiration: 86400000  # 24 hours

# ------------------------
# Direct Profile (Alternative Supabase connection for IPv6 hosts)
# ------------------------
---
spring:
  config:
    activate:
      on-profile: direct
  datasource:
    # Use Azure App Settings; no secrets in source
    url: ${SPRING_DATASOURCE_URL_DIRECT}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10   # start small 
      minimum-idle: 2
      idle-timeout: 30000     # 30s
      max-lifetime: 600000    # 10 min
      connection-timeout: 20000 # 20s
  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
  flyway:
    enabled: false  # Disable Flyway for now

# JWT Configuration for Direct
app:
  jwt:
    secret: ${JWT_SECRET}
    expiration: 86400000